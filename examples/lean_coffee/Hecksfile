domain(:LeanCoffee) do
  summary     'Lean Coffee'
  description 'Collaborative, dynamic, just in time meetings'
  version     '0.1.0'
  authors     ['Lean Coffee Developer']
  email       'dev@lean_coffee.com'
  homepage    'http://www.example.com'

  aggregate :Meetings do
    head :Meeting do
      integer :timebox_extension
      optional string(:phase)
      list(:participants).as(:Participant)
      entity(:discussion).as(Discussions: :Discussion)
      value(:timebox).as(:Timebox)

      operations %i[
        start_ordering start_collecting start_discussing move_topic add_topic
        vote_for_topic wait_for_the_next_phase order_by_vote
      ]
    end

    value(:Timebox) do
      value(:voting_duration)
      value(:collection_duration)
      value(:ordering_duration)
    end

    value(:Participant) do
      string :name
      integer :remaining_votes
    end
  end

  aggregate :Discussions do
    head(:Discussion) do
      optional string :phase
      optional value(:discussing).as(:Discussion)
      optional list(:discussed).as(:Discussion)
      optional list(:topics).as(Topics: :Topic)
      operations %w[next_topic extend start_timebox order_by_votes]
    end
  end

  aggregate :Topics do
    head(:Topic) do
      string :value
      integer :votes
      optional string :phase
      value(:timebox).as(:Timebox)
      operations %w[vote_to_extend vote_to_continue]
    end

    value(:Timebox) do
      integer :duration
      value(:extension).as(:Extension)
    end

    value(:Exension) do
      integer :duration
      integer :yes_votes
      integer :no_votes
    end
  end
end
