domain(:LeanCoffee) do
  summary     'Lean Coffee'
  description 'Collaborative, dynamic, just in time meetings'
  version     '0.1.0'
  authors     ['Lean Coffee Developer']
  email       'dev@lean_coffee.com'
  homepage    'http://www.example.com'

  aggregate :Meetings do
    head :Meeting do
      integer :timebox_extension
      optional string(:phase)
      list(:participants).as(:Participant)
      entity(:discussion).as(Discussions: :Discussion)
      value(:timebox).as(:Timebox)

      operations %i[
        start_collecting add_topic start_ordering order_by_votes move_topic
        start_discussing start_voting vote_for_topic wait_for_the_next_phase
        wait_for_topic_extension_vote vote_to_keep_talking
        vote_to_stop_talking! keep_talking! next_topic!
      ]
    end

    value(:Timebox) do
      value(:voting_duration)
      value(:collection_duration)
      value(:ordering_duration)
      value(:topic_discussion_duration)
      value(:topic_extension_duration)
    end

    value(:Participant) do
      string :name
      integer :remaining_votes
      optional list(:topic_votes).as(Topics: :Topic)
    end
  end

  aggregate :Discussions do
    head(:Discussion) do
      optional string :phase
      optional value(:discussing).as(:Discussion)
      optional list(:discussed).as(:Discussion)
      optional list(:topics).as(Topics: :Topic)
    end
  end

  aggregate :Topics do
    head(:Topic) do
      string :value
      integer :votes
      optional string :phase
      value(:timebox).as(:Timebox)
    end

    value(:Timebox) do
      integer :duration
      value(:extension).as(:Extension)
    end

    value(:Extension) do
      integer :yes_votes
      integer :no_votes
    end
  end
end
